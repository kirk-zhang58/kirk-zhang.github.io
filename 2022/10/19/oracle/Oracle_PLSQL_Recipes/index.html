
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Eden">
    <title>Oracle PLSQL Recipes - Eden</title>
    <meta name="author" content="kirkzhang">
    
    
        <link rel="icon" href="https://simonteo58.github.io/assets/images/cover-v1.2.0.jpg">
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"kirkzhang","sameAs":["https://github.com/SimonTeo58","https://stackoverflow.com/users/11289672/simon-teo","https://twitter.com/shiming_kirk","nil","nil","https://www.linkedin.com/in/kirk-zhang-424935235/","zxc741208584@qq.com"],"image":"avatar.jpg"},"articleBody":"摘要: 其实这个讲PLSQL有点基础\n\n\n\n1 PL&#x2F;SQL Fundamentals1.1 创建plsql代码块如和创建一个可以执行的plsql代码块？\n-- demo 1\nbegin\n  -- 中间写代码\nend;\n\n-- demo 2\n\n\ndeclare\n\n-- 定义变量\n\nbegin \n -- 业务逻辑\nend;\n\n在实际的开发当中，这些代码块会进行嵌套，第一层代码块定义的变量，内层的代码块也可以直接使用\n1.2 在plsql种执行plsql代码块如何在sqlplus中执行plsql代码?\n登录sqlplus就可以直接输入自己的代码，然后end;结束代码块，并且接着输入/,这时候sqlplus解释器就可以执行代码了。但是有一点需要明确，如果你的代码块是以declare开头的，那么就会直接输出到屏幕\nsql&gt; begin\nDBMS_OUTPUT.put_line(&quot;hello world&quot;)\nend;\n&#x2F;\n\n但是如果你想创建package,function,procedure,可以使用如下语句，方便后面的调用\nSQL&gt; CREATE OR REPLACE PROCEDURE hello_world AS \n BEGIN \n DBMS_OUTPUT.PUT_LINE(&#39;Hello World&#39;); \n END; \n &#x2F; \n\n1.3 store code in script如果你想通过sql脚本执行代码，该如何运行？\nSET SERVEROUTPUT ON;\nDECLARE \n counter NUMBER;\nBEGIN \n  FOR counter IN REVERSE 0..10 LOOP \n  DBMS_OUTPUT.PUT_LINE (counter); \n  END LOOP; \nEND;\n&#x2F;\n你可以保存你的plsql代码在脚本里,重要一步是要保证你的文件扩展名是.sqlSQL Developer supports a number of additionalextensions for more specific types of PL&#x2F;SQL. \n1.4 执行你的脚本登录sqlplus，然后跳(Traverse)到你的脚本目录\n@绝对路径\n@相对路径\nsqlplus username&#x2F;password@database my_stored_script.sql \n\n1.5 接受用户的输入从键盘中sqlplus使用&amp;符号来接受来自键盘的输入\nDECLARE\n emp_count NUMBER; \nBEGIN \n SELECT count(*) \n INTO emp_count \n FROM employees \n WHERE department_id &#x3D; &amp;department_id; \nEND; \n\n但是如果你想从键盘接受一个输入，但是后面又想继续使用，则可以使用如下方法\nDECLARE\n emp_count NUMBER; \nBEGIN \n  SELECT count(*) \n  INTO emp_count \n  FROM employees \n  WHERE department_id &#x3D; &amp;&amp;department_id; \n  DBMS_OUTPUT.PUT_LINE(&#39;The employee count is: &#39; || emp_count || \n  &#39; for the department with an ID of: &#39; || &amp;department_id); \nEND;\n\n\n另外还有一种方法就是定义变量来承接从键盘来的输入,但是要注意这个变量定义的类型,如果是numeric类型的，如果是varchar2类型则需要用单引号,见如下代码\nDECLARE \n    first varchar2(20); \n    last varchar2(25); \n    emp_last VARCHAR2(25) :&#x3D; &#39;&amp;last_name&#39;; \n    emp_count NUMBER; \nBEGIN \n    SELECT count(*) \n    INTO emp_count \n    FROM employees \n    WHERE last_name &#x3D; emp_last; \n IF emp_count &gt; 1 THEN \n    DBMS_OUTPUT.PUT_LINE(&#39;More than 1 employee exists with that name.&#39;); \n ELSE \n    SELECT first_name, last_name \n    INTO first, last \n    FROM employees \n    WHERE last_name &#x3D; emp_last; \n    DBMS_OUTPUT.PUT_LINE(&#39;The matching employee is: &#39; || \n    first || &#39; &#39; || last); \n END IF; \nEXCEPTION \n    WHEN NO_DATA_FOUND THEN \n    DBMS_OUTPUT.PUT_LINE(&#39;Please enter a different last name.&#39;); \nEND; \n\n1.6 Displaying Results in SQL*PlusSET SERVEROUTPUT ON is issued, then the default buffer size is 20,000 bytes.Any content that surpasses that size will be cut off. To increase the buffer, simply set the size of bufferyou’d like to use when turning the SERVEROUTPUT on: \n1.7 Commenting Your Code1.8 Referencing a Block of Code如何引用一个代码块?\n给一个代码块添加label标签,比如下面的代码\n\n&lt;&lt;dept_block&gt;&gt;\nDECLARE \n  dept_name varchar2(30); \nBEGIN \n  SELECT department_name \n  INTO dept_name \n  FROM departments \n  WHERE department_id &#x3D; 230;\n  DBMS_OUTPUT.PUT_LINE(dept_name);\nEND dept_block;\n\n\n1.9. Referring to Variables from Nested Blocks如果code block是嵌套关系那么该如何使用具有相同名字的变量,可以使用label来区分不同的变量名字\n&lt;&lt;outer_block&gt;&gt;\nDECLARE\n  mgr_id NUMBER(6) :&#x3D; &#39;&amp;current_manager_id&#39;;\n  dept_count number :&#x3D; 0;\nBEGIN\n\nSELECT count(*)\n    INTO dept_count \n    FROM departments \n    WHERE manager_id &#x3D; outer_block.mgr_id;\n\n IF dept_count &gt; 0 THEN \n    &lt;&lt;inner_block&gt;&gt; \n    DECLARE \n      dept_name VARCHAR2(30); \n      mgr_id NUMBER(6):&#x3D; &#39;&amp;new_manager_id&#39;; \n    BEGIN \n    SELECT department_name \n    INTO dept_name \n    FROM departments \n    WHERE manager_id &#x3D; outer_block.mgr_id; \n\n    UPDATE departments \n    SET manager_id &#x3D; inner_block.mgr_id \n    WHERE manager_id &#x3D; outer_block.mgr_id; \n    DBMS_OUTPUT.PUT_LINE \n    (&#39;Department manager ID has been changed for &#39; || dept_name); \n    END inner_block; \n ELSE \n    DBMS_OUTPUT.PUT_LINE(&#39;There are no departments listed for the manager&#39;); \n END IF; \nEXCEPTION \n WHEN NO_DATA_FOUND THEN \n    DBMS_OUTPUT.PUT_LINE(&#39;There are no departments listed for the manager&#39;); \nEND outer_block; \n\n但是inner block创建的变量，outside block是不会读取到的,外部块变量在内部块中是可见的，而不需要完全限定名称，并且不需要块标签\n1.10. Ignoring Substitution Variables转义那些sqlplus使用的特殊字符\nSQL&gt; SET ESCAPE &#39;\\&#39; \nSQL&gt; INSERT INTO DEPARTMENTS VALUES( \n  departments_seq.nextval, \n  &#39;Shipping \\&amp; Receiving&#39;, \n  null, \n null);\n\n还有另外一种\nSQL&gt; SET DEFINE OFF\nINSERT INTO DEPARTMENTS VALUES( \ndepartments_seq.nextval, \n&#39;Importing &amp; Exporting&#39;, \nnull, \nnull); \n\n\n1.11. Changing the Substitution Variable Character如果你对改变替换变量符号(&amp;)为其他的符号\n可以使用set define ^, 你也可以使用任意其他的符号来替换\nSQL&gt; SET DEFINE ^\nSQL&gt; SELECT department_name \n     FROM departments \n     WHERE department_id &#x3D; ^dept_id;\n\n1.12. Creating a Variable to Match a Database Column Type如果向查数据库中某一个表的数据，该如何将查询结果赋值给变量呢？可以使用%type关键字,会将一列的数据赋值给变量,而%rowtype则是返回一列的数据给变量\n\nDECLARE\n dept_name departments.department_name%TYPE; \n dept_id NUMBER(6) :&#x3D; &amp;department_id; \nBEGIN \n SELECT department_name \n INTO dept_name \n FROM departments \n WHERE department_id &#x3D; dept_id; \n DBMS_OUTPUT.PUT_LINE(&#39;The department with the given ID is: &#39; || dept_name); \nEXCEPTION \n WHEN NO_DATA_FOUND THEN \n DBMS_OUTPUT.PUT_LINE(&#39;No department for the given ID&#39;); \nEND;\n\n2.基础sql2.1 Retrieving a Single Row from the Databaseproblem\nYou are interested in returning one row from a database table via a query that searches for an exactmatch.\nsolution 1你可以使用select ... into ...语法\nDECLARE\n    first VARCHAR2(20);  -- varchar2(20)一定是要兼容的数据库表字段的\n    last VARCHAR2(25); \n    email VARCHAR2(25); \nBEGIN \n    SELECT first_name, last_name, email \n    INTO first, last, email \n    FROM employees \n    WHERE employee_id &#x3D; 100; \n    DBMS_OUTPUT.PUT_LINE( \n    &#39;Employee Information for ID: &#39; || first || &#39; &#39; || last || &#39; - &#39; || email); \nEXCEPTION \nWHEN NO_DATA_FOUND THEN \n    DBMS_OUTPUT.PUT_LINE(&#39;No employee matches the given ID&#39;); \nWHEN TOO_MANY_ROWS THEN\n    DBMS_OUTPUT.PUT_LINE(&#39;More than one employee matches the given ID&#39;); \nEND; \n\nsolution 2\nDECLARE\n CURSOR emp_cursor IS \n SELECT first_name, last_name, email \n FROM employees \n WHERE employee_id &#x3D; &amp;emp_id; \n first VARCHAR2(20); \n last VARCHAR2(25); \n email VARCHAR2(25); \nBEGIN \n OPEN emp_cursor; \n FETCH emp_cursor INTO first, last, email; \n IF emp_cursor%NOTFOUND THEN \n      RAISE NO_DATA_FOUND; \n ELSE \n -- Perform second fetch to see if more than one row is returned \n    FETCH emp_cursor INTO first, last, email; \n    IF emp_cursor%FOUND THEN \n      RAISE TOO_MANY_ROWS; \n    ELSE \n      DBMS_OUTPUT.PUT_LINE( \n      &#39;Employee Information for ID: &#39; || first || &#39; &#39; || last || &#39; - &#39; || email); \n      END IF;\n END IF; \nCLOSE emp_cursor; \n\n\nhow it works\nsolution 1: One is to issue a SELECT…INTO statement,which is a statement designed to return just one row.The other approach is to open a cursor, fetch the  one row, and close the cursorsolution 2: We keep an open mind on that point. Consider that if youare expecting exactly one row to bereturned, getting multiple rows back represents an exception case that you must somehow deal with.The cursor-based solution makes it easy to simply ignore that exception case, but ignoring a conditionthat you do not expect to occur does not change the fact that it has occurred. Although a cursor is used,the cases where no data is returned or where too many rows are returnedgiven the user-supplied EMPLOYEE_IDstill remain a reality. However, since cursors are specifically designed to deal with zero rows or morethan one row coming back from a query, no exceptions will be raised if these situations occur. For this reason,Solution #2 contains some conditional logic that is used to manually raise the desired exceptions.In the event that the user supplies the block with an invalid EMPLOYEE_ID, the cursor will not fetch any data. The %NOTFOUND attribute of the cursor will be checked to see whether the cursor successfully fetched data. If not, then the NO_DATA_FOUND exception is raised. If the cursor is successful in retrieving data, then a second FETCH statement is issued to see whether more thanone row will be returned. If more than one row is returned, then the TOO_MANY_ROWS exception is raised;otherwise, the expected output is displayed. In any event, the output that is displayed using either of thesolutions will be the same whether successful or not.\nQualifying Column and Variable Names（变量和表列名相同)ProblemYou have a variable and a column sharing the same name. You want to refer to both in the same SQLstatement.For example, you decide that you’d like to search for records where LAST_NAME is not equal to a lastname that is provided by a user via an argument to a procedure call. Suppose you have declared avariable LAST_NAME, and you want to alter the query to read as follows: \nSELECT first_name, last_name, email\n INTO first, last, email \n FROM employees \nWHERE last_name &#x3D; last_name; \nHow does PL&#x2F;SQL know which LAST_NAME you are referring to since both the table column name andthe variable name are the same? You need a way to differentiate your references. \nSolutionYou can use the dot notation to fully qualify the local variable name with the procedure name so thatPL&#x2F;SQL can differentiate between the two. The altered query, including the fully qualifiedprocedure_name.variable solution, would read as follows: \nCREATE OR REPLACE PROCEDURE retrieve_emp_info(last_name IN VARCHAR2) AS \n first VARCHAR2(20); \n last VARCHAR2(25); \n email VARCHAR2(25); \nBEGIN \n SELECT first_name, last_name, email \n INTO first, last, email \n FROM employees \n WHERE last_name &#x3D; retrieve_emp_info.last_name; \n DBMS_OUTPUT.PUT_LINE( \n &#39;Employee Information for ID: &#39; || first || &#39; &#39; || last_name || &#39; - &#39; || email); \nEXCEPTION \n WHEN NO_DATA_FOUND THEN \n DBMS_OUTPUT.PUT_LINE(&#39;No employee matches the last name &#39; || last_name); \nEND; \n\nHow It Works\nPL&#x2F;SQL name resolution(方法) becomes very important in circumstances such as these, and by fully qualifyingthe names, you can be sure that your code will work as expected. The solution used dot notation to fullyqualify the variable name. \nThe column name could have been qualified with the table name, as in EMPLOYEES.LAST_NAME.However, there’s no need to qualify the column name in this case. Because the reference occurs within aSELECT, the closest resolution for LAST_NAME becomes the table column of that name. So, in this particularcase, it is necessary only to qualify references to variable names in the enclosing PL&#x2F;SQL block. \nIf you are executing a simple BEGIN…END block, then you also have the option of fully qualifying thevariable using the dot notation along with the block label. For the purposes of this demonstration, let’ssay that the code block shown in the solution was labeled &lt;&gt;. You could then fully qualify avariable named description as follows: \nside note:\n\n\n&lt;&lt;emp_info&gt;&gt;\nDECLARE \n last_name VARCHAR2(25) :&#x3D; &#39;Fay&#39;; \n first VARCHAR2(20); \n last VARCHAR2(25); \n email VARCHAR2(25); \nBEGIN \n SELECT first_name, last_name, email \n INTO first, last, email \n FROM employees \n WHERE last_name &#x3D; emp_info.last_name; \nEND; \n\nIn this example, the LAST_NAME that is declared in the code block is used within the SELECT..INTOquery, and it is fully qualified with the code block label.\n\nsummary: \n1. while code block contain same variable name as parameter, we could use \"procedure\"(including package name i though) name qualify parameter name at where clause statement.\n2. actualy you could use table name qualify parameter name in code block, but no more works on it,due to in your select statement,\nit had been qualified by table name.\n3. and so on , if you use label on your code block, as case shown above\n\n\n2.3. Declaring Variable Types That Match Column TypesProblemYou want to declare some variables in your code block that match the same datatypes as some columnsin a particular table. If the datatype on one of those columns changes, you’d like the code block toautomatically update the variable type to match that of the updated column\nNoteSharp-eyed readers will notice that we cover this problem redundantly in Chapter 1. We cover thisproblem here as well, because the solution is fundamental to working in PL&#x2F;SQL, especially to working with SQL inPL&#x2F;SQL. We don’t want you to miss what we discuss in this recipe. It is that important.\nSolutionUse the %TYPE attribute(n.属性) on table columns to identify(v.确定) the types of data that will be returned into your local variables. Instead of providing a hard-coded datatype for a variable, append %TYPE to the database column name. Doing so will apply the datatype from the specified column to the variable you are declaring.\nIn the following example, the same SELECT INTO query is issued, as in the previous problem, to retrieve an employee record from the database. However, in this case, the variables are declared using the %TYPE attribute rather than designating a specified datatype for each.\nDECLARE \n  first   employees.first_name%TYPE;\n  last    employees.last_name%TYPE;\n  email   employees.email%TYPE;\nBEGIN \nSELECT \n  first_name, \n  last_name, \n  email INTO first, last, email \nFROM \n  employees \nWHERE \n  employee_id &#x3D; &amp; emp_id;\n  DBMS_OUTPUT.PUT_LINE(&#39;Employee Information for ID: &#39; || first || &#39; &#39; || last || &#39; - &#39; || email);\nEXCEPTION WHEN NO_DATA_FOUND THEN DBMS_OUTPUT.PUT_LINE(&#39;No matching employee was found, please try again.&#39;);\nWHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE(&#39;An unknown error has occured, please try again.&#39;);\nEND;\n\nAs you can see from the solution, the code block looks essentially the same as the one in the previous recipe. The only difference is that here the %TYPE attribute of each database column is being used in order to declare your local variable types.\nHow It WorksThe %TYPE attribute can become a significant time-saver and savior for declaring variable types, especially if the underlying database column types are subject(会发生变化) to change. This attribute enables the local variable to assume the same datatype of its corresponding database column type at runtime. Retrieving several columns into local application variables can become tedious(沉闷的) if you need to continually verify that the datatypes of each variable are the same as those of the columns whose data they will consume.The%TYPE attribute can be used when defining variables, constants, fields, and parameters. Using %TYPE assures(保证) that the variables you declare will always remain synchronized with the datatypes of their corresponding columns.\n\nsummary:  \nat all above explained that we could use `%TYPE` attribute to define variable which the same as table datatype\n","dateCreated":"2022-10-19T23:51:33+08:00","dateModified":"2022-10-27T23:22:16+08:00","datePublished":"2022-10-19T23:51:33+08:00","description":"摘要: 其实这个讲PLSQL有点基础","headline":"Oracle PLSQL Recipes","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://simonteo58.github.io/2022/10/19/oracle/Oracle_PLSQL_Recipes/"},"publisher":{"@type":"Organization","name":"kirkzhang","sameAs":["https://github.com/SimonTeo58","https://stackoverflow.com/users/11289672/simon-teo","https://twitter.com/shiming_kirk","nil","nil","https://www.linkedin.com/in/kirk-zhang-424935235/","zxc741208584@qq.com"],"image":"avatar.jpg","logo":{"@type":"ImageObject","url":"avatar.jpg"}},"url":"https://simonteo58.github.io/2022/10/19/oracle/Oracle_PLSQL_Recipes/"}</script>
    <meta name="description" content="摘要: 其实这个讲PLSQL有点基础">
<meta property="og:type" content="blog">
<meta property="og:title" content="Oracle PLSQL Recipes">
<meta property="og:url" content="https://simonteo58.github.io/2022/10/19/oracle/Oracle_PLSQL_Recipes/index.html">
<meta property="og:site_name" content="Eden">
<meta property="og:description" content="摘要: 其实这个讲PLSQL有点基础">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-10-19T15:51:33.289Z">
<meta property="article:modified_time" content="2022-10-27T15:22:16.095Z">
<meta property="article:author" content="kirkzhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@shiming_kirk">
    
        <link rel="publisher" href="https://plus.google.com/nil"/>
    
    
        
    
    
        <meta property="og:image" content="https://simonteo58.github.io/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-qfabngyeqy4bujk0yqtgvk4es1h4x8u5fxt0hwcrptgqlaytn2puqd9gogz3.min.css">

    <!--STYLES END-->
    

    

    
        
            
<link rel="stylesheet" href="/assets/css/gitalk.css">

        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Eden
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">kirkzhang</h4>
                
                    <h5 class="sidebar-profile-bio"><p>author.bio</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/SimonTeo58"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://stackoverflow.com/users/11289672/simon-teo"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/shiming_kirk"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/nil"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/nil"
                            
                            rel="noopener"
                            title="Google +"
                        >
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google +</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/kirk-zhang-424935235/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/zxc741208584@qq.com"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Oracle PLSQL Recipes
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2022-10-19T23:51:33+08:00">
	
		    Oct 19, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/oracle/">oracle</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>摘要: 其实这个讲PLSQL有点基础</p>
<span id="more"></span>

<h1 id="table-of-contents">Table of Contents</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-PL-x2F-SQL-Fundamentals"><span class="toc-text">1 PL&#x2F;SQL Fundamentals</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%88%9B%E5%BB%BAplsql%E4%BB%A3%E7%A0%81%E5%9D%97"><span class="toc-text">1.1 创建plsql代码块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%9C%A8plsql%E7%A7%8D%E6%89%A7%E8%A1%8Cplsql%E4%BB%A3%E7%A0%81%E5%9D%97"><span class="toc-text">1.2 在plsql种执行plsql代码块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-store-code-in-script"><span class="toc-text">1.3 store code in script</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E6%89%A7%E8%A1%8C%E4%BD%A0%E7%9A%84%E8%84%9A%E6%9C%AC"><span class="toc-text">1.4 执行你的脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E6%8E%A5%E5%8F%97%E7%94%A8%E6%88%B7%E7%9A%84%E8%BE%93%E5%85%A5%E4%BB%8E%E9%94%AE%E7%9B%98%E4%B8%AD"><span class="toc-text">1.5 接受用户的输入从键盘中</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-Displaying-Results-in-SQL-Plus"><span class="toc-text">1.6 Displaying Results in SQL*Plus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-Commenting-Your-Code"><span class="toc-text">1.7 Commenting Your Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-8-Referencing-a-Block-of-Code"><span class="toc-text">1.8 Referencing a Block of Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-9-Referring-to-Variables-from-Nested-Blocks"><span class="toc-text">1.9. Referring to Variables from Nested Blocks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-10-Ignoring-Substitution-Variables"><span class="toc-text">1.10. Ignoring Substitution Variables</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-11-Changing-the-Substitution-Variable-Character"><span class="toc-text">1.11. Changing the Substitution Variable Character</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-12-Creating-a-Variable-to-Match-a-Database-Column-Type"><span class="toc-text">1.12. Creating a Variable to Match a Database Column Type</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%9F%BA%E7%A1%80sql"><span class="toc-text">2.基础sql</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Retrieving-a-Single-Row-from-the-Database"><span class="toc-text">2.1 Retrieving a Single Row from the Database</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Qualifying-Column-and-Variable-Names%EF%BC%88%E5%8F%98%E9%87%8F%E5%92%8C%E8%A1%A8%E5%88%97%E5%90%8D%E7%9B%B8%E5%90%8C"><span class="toc-text">Qualifying Column and Variable Names（变量和表列名相同)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Declaring-Variable-Types-That-Match-Column-Types"><span class="toc-text">2.3. Declaring Variable Types That Match Column Types</span></a></li></ol></li></ol>
<h1 id="1-PL-x2F-SQL-Fundamentals"><a href="#1-PL-x2F-SQL-Fundamentals" class="headerlink" title="1 PL&#x2F;SQL Fundamentals"></a>1 PL&#x2F;SQL Fundamentals</h1><h2 id="1-1-创建plsql代码块"><a href="#1-1-创建plsql代码块" class="headerlink" title="1.1 创建plsql代码块"></a>1.1 创建plsql代码块</h2><p>如和创建一个可以执行的plsql代码块？</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">-- demo 1
begin
  -- 中间写代码
end;

-- demo 2


declare

-- 定义变量

begin 
 -- 业务逻辑
end;</code></pre>

<p>在实际的开发当中，这些代码块会进行嵌套，第一层代码块定义的变量，内层的代码块也可以直接使用</p>
<h2 id="1-2-在plsql种执行plsql代码块"><a href="#1-2-在plsql种执行plsql代码块" class="headerlink" title="1.2 在plsql种执行plsql代码块"></a>1.2 在plsql种执行plsql代码块</h2><p>如何在sqlplus中执行plsql代码?</p>
<p>登录sqlplus就可以直接输入自己的代码，然后<code>end;</code>结束代码块，并且接着输入<code>/</code>,这时候sqlplus解释器就可以执行代码了。<br>但是有一点需要明确，如果你的代码块是以<code>declare</code>开头的，那么就会直接输出到屏幕</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">sql&gt; begin
DBMS_OUTPUT.put_line(&quot;hello world&quot;)
end;
&#x2F;</code></pre>

<p>但是如果你想创建package,function,procedure,可以使用如下语句，方便后面的调用</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">SQL&gt; CREATE OR REPLACE PROCEDURE hello_world AS 
 BEGIN 
 DBMS_OUTPUT.PUT_LINE(&#39;Hello World&#39;); 
 END; 
 &#x2F; </code></pre>

<h2 id="1-3-store-code-in-script"><a href="#1-3-store-code-in-script" class="headerlink" title="1.3 store code in script"></a>1.3 store code in script</h2><p>如果你想通过sql脚本执行代码，该如何运行？</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">SET SERVEROUTPUT ON;
DECLARE 
 counter NUMBER;
BEGIN 
  FOR counter IN REVERSE 0..10 LOOP 
  DBMS_OUTPUT.PUT_LINE (counter); 
  END LOOP; 
END;
&#x2F;</code></pre>
<p>你可以保存你的plsql代码在脚本里,重要一步是要保证你的文件扩展名是<code>.sql</code><br>SQL Developer supports a number of additionalextensions for more specific types of PL&#x2F;SQL. </p>
<h2 id="1-4-执行你的脚本"><a href="#1-4-执行你的脚本" class="headerlink" title="1.4 执行你的脚本"></a>1.4 执行你的脚本</h2><p>登录sqlplus，然后跳(Traverse)到你的脚本目录</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">@绝对路径
@相对路径
sqlplus username&#x2F;password@database my_stored_script.sql </code></pre>

<h2 id="1-5-接受用户的输入从键盘中"><a href="#1-5-接受用户的输入从键盘中" class="headerlink" title="1.5 接受用户的输入从键盘中"></a>1.5 接受用户的输入从键盘中</h2><p>sqlplus使用&amp;符号来接受来自键盘的输入</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">DECLARE
 emp_count NUMBER; 
BEGIN 
 SELECT count(*) 
 INTO emp_count 
 FROM employees 
 WHERE department_id &#x3D; &amp;department_id; 
END; </code></pre>

<p>但是如果你想从键盘接受一个输入，但是后面又想继续使用，则可以使用如下方法</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">DECLARE
 emp_count NUMBER; 
BEGIN 
  SELECT count(*) 
  INTO emp_count 
  FROM employees 
  WHERE department_id &#x3D; &amp;&amp;department_id; 
  DBMS_OUTPUT.PUT_LINE(&#39;The employee count is: &#39; || emp_count || 
  &#39; for the department with an ID of: &#39; || &amp;department_id); 
END;
</code></pre>

<p>另外还有一种方法就是定义变量来承接从键盘来的输入,但是要注意这个变量定义的类型,如果是numeric类型的，如果是varchar2类型则需要用<code>单引号</code>,见如下代码</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">DECLARE 
    first varchar2(20); 
    last varchar2(25); 
    emp_last VARCHAR2(25) :&#x3D; &#39;&amp;last_name&#39;; 
    emp_count NUMBER; 
BEGIN 
    SELECT count(*) 
    INTO emp_count 
    FROM employees 
    WHERE last_name &#x3D; emp_last; 
 IF emp_count &gt; 1 THEN 
    DBMS_OUTPUT.PUT_LINE(&#39;More than 1 employee exists with that name.&#39;); 
 ELSE 
    SELECT first_name, last_name 
    INTO first, last 
    FROM employees 
    WHERE last_name &#x3D; emp_last; 
    DBMS_OUTPUT.PUT_LINE(&#39;The matching employee is: &#39; || 
    first || &#39; &#39; || last); 
 END IF; 
EXCEPTION 
    WHEN NO_DATA_FOUND THEN 
    DBMS_OUTPUT.PUT_LINE(&#39;Please enter a different last name.&#39;); 
END; </code></pre>

<h2 id="1-6-Displaying-Results-in-SQL-Plus"><a href="#1-6-Displaying-Results-in-SQL-Plus" class="headerlink" title="1.6 Displaying Results in SQL*Plus"></a>1.6 Displaying Results in SQL*Plus</h2><p><code>SET SERVEROUTPUT ON</code> is issued, then the default buffer size is 20,000 bytes.<br>Any content that surpasses that size will be cut off. To increase the buffer, simply set the size of buffer<br>you’d like to use when turning the SERVEROUTPUT on: </p>
<h2 id="1-7-Commenting-Your-Code"><a href="#1-7-Commenting-Your-Code" class="headerlink" title="1.7 Commenting Your Code"></a>1.7 Commenting Your Code</h2><h2 id="1-8-Referencing-a-Block-of-Code"><a href="#1-8-Referencing-a-Block-of-Code" class="headerlink" title="1.8 Referencing a Block of Code"></a>1.8 Referencing a Block of Code</h2><p>如何引用一个代码块?</p>
<p>给一个代码块添加label标签,比如下面的代码</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">
&lt;&lt;dept_block&gt;&gt;
DECLARE 
  dept_name varchar2(30); 
BEGIN 
  SELECT department_name 
  INTO dept_name 
  FROM departments 
  WHERE department_id &#x3D; 230;
  DBMS_OUTPUT.PUT_LINE(dept_name);
END dept_block;
</code></pre>

<h2 id="1-9-Referring-to-Variables-from-Nested-Blocks"><a href="#1-9-Referring-to-Variables-from-Nested-Blocks" class="headerlink" title="1.9. Referring to Variables from Nested Blocks"></a>1.9. Referring to Variables from Nested Blocks</h2><p>如果code block是嵌套关系那么该如何使用具有相同名字的变量,可以使用label来区分不同的变量名字</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">&lt;&lt;outer_block&gt;&gt;
DECLARE
  mgr_id NUMBER(6) :&#x3D; &#39;&amp;current_manager_id&#39;;
  dept_count number :&#x3D; 0;
BEGIN

SELECT count(*)
    INTO dept_count 
    FROM departments 
    WHERE manager_id &#x3D; outer_block.mgr_id;

 IF dept_count &gt; 0 THEN 
    &lt;&lt;inner_block&gt;&gt; 
    DECLARE 
      dept_name VARCHAR2(30); 
      mgr_id NUMBER(6):&#x3D; &#39;&amp;new_manager_id&#39;; 
    BEGIN 
    SELECT department_name 
    INTO dept_name 
    FROM departments 
    WHERE manager_id &#x3D; outer_block.mgr_id; 

    UPDATE departments 
    SET manager_id &#x3D; inner_block.mgr_id 
    WHERE manager_id &#x3D; outer_block.mgr_id; 
    DBMS_OUTPUT.PUT_LINE 
    (&#39;Department manager ID has been changed for &#39; || dept_name); 
    END inner_block; 
 ELSE 
    DBMS_OUTPUT.PUT_LINE(&#39;There are no departments listed for the manager&#39;); 
 END IF; 
EXCEPTION 
 WHEN NO_DATA_FOUND THEN 
    DBMS_OUTPUT.PUT_LINE(&#39;There are no departments listed for the manager&#39;); 
END outer_block; </code></pre>

<p>但是inner block创建的变量，outside block是不会读取到的,外部块变量在内部块中是可见的，而不需要完全限定名称，并且不需要块标签</p>
<h2 id="1-10-Ignoring-Substitution-Variables"><a href="#1-10-Ignoring-Substitution-Variables" class="headerlink" title="1.10. Ignoring Substitution Variables"></a>1.10. Ignoring Substitution Variables</h2><p>转义那些sqlplus使用的特殊字符</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">SQL&gt; SET ESCAPE &#39;\&#39; 
SQL&gt; INSERT INTO DEPARTMENTS VALUES( 
  departments_seq.nextval, 
  &#39;Shipping \&amp; Receiving&#39;, 
  null, 
 null);</code></pre>

<p>还有另外一种</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">SQL&gt; SET DEFINE OFF
INSERT INTO DEPARTMENTS VALUES( 
departments_seq.nextval, 
&#39;Importing &amp; Exporting&#39;, 
null, 
null); 
</code></pre>

<h2 id="1-11-Changing-the-Substitution-Variable-Character"><a href="#1-11-Changing-the-Substitution-Variable-Character" class="headerlink" title="1.11. Changing the Substitution Variable Character"></a>1.11. Changing the Substitution Variable Character</h2><p>如果你对改变替换变量符号(&amp;)为其他的符号</p>
<p>可以使用<code>set define ^</code>, 你也可以使用任意其他的符号来替换</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">SQL&gt; SET DEFINE ^
SQL&gt; SELECT department_name 
     FROM departments 
     WHERE department_id &#x3D; ^dept_id;</code></pre>

<h2 id="1-12-Creating-a-Variable-to-Match-a-Database-Column-Type"><a href="#1-12-Creating-a-Variable-to-Match-a-Database-Column-Type" class="headerlink" title="1.12. Creating a Variable to Match a Database Column Type"></a>1.12. Creating a Variable to Match a Database Column Type</h2><p>如果向查数据库中某一个表的数据，该如何将查询结果赋值给变量呢？<br>可以使用<code>%type</code>关键字,会将一列的数据赋值给变量,而<code>%rowtype</code>则是返回一列的数据给变量</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">
DECLARE
 dept_name departments.department_name%TYPE; 
 dept_id NUMBER(6) :&#x3D; &amp;department_id; 
BEGIN 
 SELECT department_name 
 INTO dept_name 
 FROM departments 
 WHERE department_id &#x3D; dept_id; 
 DBMS_OUTPUT.PUT_LINE(&#39;The department with the given ID is: &#39; || dept_name); 
EXCEPTION 
 WHEN NO_DATA_FOUND THEN 
 DBMS_OUTPUT.PUT_LINE(&#39;No department for the given ID&#39;); 
END;</code></pre>

<h1 id="2-基础sql"><a href="#2-基础sql" class="headerlink" title="2.基础sql"></a>2.基础sql</h1><h2 id="2-1-Retrieving-a-Single-Row-from-the-Database"><a href="#2-1-Retrieving-a-Single-Row-from-the-Database" class="headerlink" title="2.1 Retrieving a Single Row from the Database"></a>2.1 Retrieving a Single Row from the Database</h2><p><strong>problem</strong></p>
<p>You are interested in returning one row from a database table via a query that searches for an exact<br>match.</p>
<p><strong>solution 1</strong><br>你可以使用<code>select ... into ...</code>语法</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">DECLARE
    first VARCHAR2(20);  -- varchar2(20)一定是要兼容的数据库表字段的
    last VARCHAR2(25); 
    email VARCHAR2(25); 
BEGIN 
    SELECT first_name, last_name, email 
    INTO first, last, email 
    FROM employees 
    WHERE employee_id &#x3D; 100; 
    DBMS_OUTPUT.PUT_LINE( 
    &#39;Employee Information for ID: &#39; || first || &#39; &#39; || last || &#39; - &#39; || email); 
EXCEPTION 
WHEN NO_DATA_FOUND THEN 
    DBMS_OUTPUT.PUT_LINE(&#39;No employee matches the given ID&#39;); 
WHEN TOO_MANY_ROWS THEN
    DBMS_OUTPUT.PUT_LINE(&#39;More than one employee matches the given ID&#39;); 
END; </code></pre>

<p><strong>solution 2</strong></p>
<pre class="language-sql" data-language="sql"><code class="language-sql">DECLARE
 CURSOR emp_cursor IS 
 SELECT first_name, last_name, email 
 FROM employees 
 WHERE employee_id &#x3D; &amp;emp_id; 
 first VARCHAR2(20); 
 last VARCHAR2(25); 
 email VARCHAR2(25); 
BEGIN 
 OPEN emp_cursor; 
 FETCH emp_cursor INTO first, last, email; 
 IF emp_cursor%NOTFOUND THEN 
      RAISE NO_DATA_FOUND; 
 ELSE 
 -- Perform second fetch to see if more than one row is returned 
    FETCH emp_cursor INTO first, last, email; 
    IF emp_cursor%FOUND THEN 
      RAISE TOO_MANY_ROWS; 
    ELSE 
      DBMS_OUTPUT.PUT_LINE( 
      &#39;Employee Information for ID: &#39; || first || &#39; &#39; || last || &#39; - &#39; || email); 
      END IF;
 END IF; 
CLOSE emp_cursor; 
</code></pre>

<p><strong>how it works</strong></p>
<p>solution 1: One is to issue a SELECT…INTO statement,which is a statement designed to return just one row.<br>The other approach is to open a cursor, fetch the  one row, and close the cursor<br>solution 2: We keep an open mind on that point. Consider that if youare expecting exactly one row to be<br>returned, getting multiple rows back represents an exception case that you must somehow deal with.<br>The cursor-based solution makes it easy to simply ignore that exception case, but ignoring a condition<br>that you do not expect to occur does not change the fact that it has occurred. Although a cursor is used,<br>the cases where no data is returned or where too many rows are returnedgiven the user-supplied EMPLOYEE_ID<br>still remain a reality. However, since cursors are specifically designed to deal with zero rows or more<br>than one row coming back from a query, no exceptions will be raised if these situations occur. For this reason,<br>Solution #2 contains some conditional logic that is used to manually raise the desired exceptions.In the event that the user supplies the block with an invalid EMPLOYEE_ID, the cursor will not fetch any data. The %NOTFOUND attribute of the cursor will be checked to see whether the cursor successfully fetched data. If not, then the NO_DATA_FOUND exception is raised. If the cursor is successful in retrieving data, then a second FETCH statement is issued to see whether more than<br>one row will be returned. If more than one row is returned, then the TOO_MANY_ROWS exception is raised;<br>otherwise, the expected output is displayed. In any event, the output that is displayed using either of the<br>solutions will be the same whether successful or not.</p>
<h2 id="Qualifying-Column-and-Variable-Names（变量和表列名相同"><a href="#Qualifying-Column-and-Variable-Names（变量和表列名相同" class="headerlink" title="Qualifying Column and Variable Names（变量和表列名相同)"></a>Qualifying Column and Variable Names（变量和表列名相同)</h2><p><strong>Problem</strong><br>You have a variable and a column sharing the same name. You want to refer to both in the same SQL<br>statement.<br>For example, you decide that you’d like to search for records where LAST_NAME is not equal to a last<br>name that is provided by a user via an argument to a procedure call. Suppose you have declared a<br>variable LAST_NAME, and you want to alter the query to read as follows: </p>
<pre class="language-sql" data-language="sql"><code class="language-sql">SELECT first_name, last_name, email
 INTO first, last, email 
 FROM employees 
WHERE last_name &#x3D; last_name; </code></pre>
<p>How does PL&#x2F;SQL know which LAST_NAME you are referring to since both the table column name and<br>the variable name are the same? You need a way to differentiate your references. </p>
<p><strong>Solution</strong><br>You can use the dot notation to fully qualify the local variable name with the procedure name so that<br>PL&#x2F;SQL can differentiate between the two. The altered query, including the fully qualified<br>procedure_name.variable solution, would read as follows: </p>
<pre class="language-sql" data-language="sql"><code class="language-sql">CREATE OR REPLACE PROCEDURE retrieve_emp_info(last_name IN VARCHAR2) AS 
 first VARCHAR2(20); 
 last VARCHAR2(25); 
 email VARCHAR2(25); 
BEGIN 
 SELECT first_name, last_name, email 
 INTO first, last, email 
 FROM employees 
 WHERE last_name &#x3D; retrieve_emp_info.last_name; 
 DBMS_OUTPUT.PUT_LINE( 
 &#39;Employee Information for ID: &#39; || first || &#39; &#39; || last_name || &#39; - &#39; || email); 
EXCEPTION 
 WHEN NO_DATA_FOUND THEN 
 DBMS_OUTPUT.PUT_LINE(&#39;No employee matches the last name &#39; || last_name); 
END; </code></pre>

<p><strong>How It Works</strong></p>
<p>PL&#x2F;SQL name resolution(方法) becomes very important in circumstances such as these, and by fully qualifying<br>the names, you can be sure that your code will work as expected. The solution used dot notation to fully<br>qualify the variable name. </p>
<p>The column name could have been qualified with the table name, as in EMPLOYEES.LAST_NAME.<br>However, there’s no need to qualify the column name in this case. Because the reference occurs within a<br>SELECT, the closest resolution for LAST_NAME becomes the table column of that name. So, in this particular<br>case, it is necessary only to qualify references to variable names in the enclosing PL&#x2F;SQL block. </p>
<p>If you are executing a simple BEGIN…END block, then you also have the option of fully qualifying the<br>variable using the dot notation along with the block label. For the purposes of this demonstration, let’s<br>say that the code block shown in the solution was labeled &lt;<emp_info>&gt;. You could then fully qualify a<br>variable named description as follows: </p>
<pre class="language-text" data-language="text"><code class="language-text">side note:
</code></pre>

<pre class="language-sql" data-language="sql"><code class="language-sql">&lt;&lt;emp_info&gt;&gt;
DECLARE 
 last_name VARCHAR2(25) :&#x3D; &#39;Fay&#39;; 
 first VARCHAR2(20); 
 last VARCHAR2(25); 
 email VARCHAR2(25); 
BEGIN 
 SELECT first_name, last_name, email 
 INTO first, last, email 
 FROM employees 
 WHERE last_name &#x3D; emp_info.last_name; 
END; </code></pre>

<p>In this example, the LAST_NAME that is declared in the code block is used within the SELECT..INTO<br>query, and it is fully qualified with the code block label.</p>
<text style="font-family:Courier New;color:red">
summary: 
1. while code block contain same variable name as parameter, we could use "procedure"(including package name i though) name qualify parameter name at where clause statement.
2. actualy you could use table name qualify parameter name in code block, but no more works on it,due to in your select statement,
it had been qualified by table name.
3. and so on , if you use label on your code block, as case shown above
</text>

<h2 id="2-3-Declaring-Variable-Types-That-Match-Column-Types"><a href="#2-3-Declaring-Variable-Types-That-Match-Column-Types" class="headerlink" title="2.3. Declaring Variable Types That Match Column Types"></a>2.3. Declaring Variable Types That Match Column Types</h2><p><strong>Problem</strong><br>You want to declare some variables in your code block that match the same datatypes as some columns<br>in a particular table. If the datatype on one of those columns changes, you’d like the code block to<br>automatically update the variable type to match that of the updated column</p>
<p><strong>Note</strong><br>Sharp-eyed readers will notice that we cover this problem redundantly in Chapter 1. We cover this<br>problem here as well, because the solution is fundamental to working in PL&#x2F;SQL, especially to working with SQL in<br>PL&#x2F;SQL. We don’t want you to miss what we discuss in this recipe. It is that important.</p>
<p><strong>Solution</strong><br>Use the <code>%TYPE</code> attribute(n.属性) on table columns to identify(v.确定) the types of data that will be returned into your local variables. Instead of providing a hard-coded datatype for a variable, append %TYPE to the database column name. Doing so will apply the datatype from the specified column to the variable you are declaring.</p>
<p>In the following example, the same <code>SELECT INTO</code> query is issued, as in the previous problem, to retrieve an employee record from the database. However, in this case, the variables are declared using the <code>%TYPE</code> attribute rather than designating a specified datatype for each.</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">DECLARE 
  first   employees.first_name%TYPE;
  last    employees.last_name%TYPE;
  email   employees.email%TYPE;
BEGIN 
SELECT 
  first_name, 
  last_name, 
  email INTO first, last, email 
FROM 
  employees 
WHERE 
  employee_id &#x3D; &amp; emp_id;
  DBMS_OUTPUT.PUT_LINE(&#39;Employee Information for ID: &#39; || first || &#39; &#39; || last || &#39; - &#39; || email);
EXCEPTION WHEN NO_DATA_FOUND THEN DBMS_OUTPUT.PUT_LINE(&#39;No matching employee was found, please try again.&#39;);
WHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE(&#39;An unknown error has occured, please try again.&#39;);
END;</code></pre>

<p>As you can see from the solution, the code block looks essentially the same as the one in the previous recipe. The only difference is that here the <code>%TYPE</code> attribute of each database column is being used in order to declare your local variable types.</p>
<p><strong>How It Works</strong><br>The <code>%TYPE</code> attribute can become a significant time-saver and savior for declaring variable types, especially if the underlying database column types are subject(会发生变化) to change. This attribute enables the local variable to assume the same datatype of its corresponding database column type at runtime. Retrieving several columns into local application variables can become tedious(<code>沉闷的</code>) if you need to continually verify that the datatypes of each variable are the same as those of the columns whose data they will consume.The<code>%TYPE</code> attribute can be used when defining variables, constants, fields, and parameters. Using <code>%TYPE</code> assures(<code>保证</code>) that the variables you declare will always remain synchronized with the datatypes of their corresponding columns.</p>
<text style="font-family:Courier New;color:red">
summary:  
at all above explained that we could use `%TYPE` attribute to define variable which the same as table datatype
</text>
            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/10/20/archive/iso8583%E7%AE%80%E4%BB%8B/"
                    data-tooltip="iso8583简介"
                    aria-label="PREVIOUS: iso8583简介"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/10/19/%E9%9D%9E%E6%8A%80%E6%9C%AF%E7%B1%BB/%E5%8E%9F%E7%94%9F%E5%AE%B6%E5%BA%AD%E5%A6%82%E4%BD%95%E4%BF%AE%E8%A1%A5%E8%87%AA%E5%B7%B1%E7%9A%84%E6%80%A7%E6%A0%BC%E7%BC%BA%E9%99%B7/"
                    data-tooltip="原生家庭如何修补自己的性格缺陷"
                    aria-label="NEXT: 原生家庭如何修补自己的性格缺陷"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href=""
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href=""
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href=""
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#gitalk"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="gitalk"></div>

            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 kirkzhang. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/10/20/archive/iso8583%E7%AE%80%E4%BB%8B/"
                    data-tooltip="iso8583简介"
                    aria-label="PREVIOUS: iso8583简介"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/10/19/%E9%9D%9E%E6%8A%80%E6%9C%AF%E7%B1%BB/%E5%8E%9F%E7%94%9F%E5%AE%B6%E5%BA%AD%E5%A6%82%E4%BD%95%E4%BF%AE%E8%A1%A5%E8%87%AA%E5%B7%B1%E7%9A%84%E6%80%A7%E6%A0%BC%E7%BC%BA%E9%99%B7/"
                    data-tooltip="原生家庭如何修补自己的性格缺陷"
                    aria-label="NEXT: 原生家庭如何修补自己的性格缺陷"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href=""
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href=""
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href=""
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#gitalk"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href=""
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href=""
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href=""
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">kirkzhang</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Canton
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-48ck9coqsaipum7yktedc1z371mex3mu18pihz9o0ii90n3cdqorsjc9v8hy.min.js"></script>

<!--SCRIPTS END-->


    
        
<script src="/assets/js/gitalk.js"></script>

        <script type="text/javascript">
          (function() {
            new Gitalk({
              clientID: 'ca29b9a1203b5920918d',
              clientSecret: 'b1b2a10320acecd54ae9427f140164b2e63d13f5',
              repo: 'SimonTeo58.github.io',
              owner: 'SimonTeo58',
              admin: ['SimonTeo58'],
              id: '2022/10/19/oracle/Oracle_PLSQL_Recipes/',
              ...{"language":"en","perPage":10,"distractionFreeMode":false,"enableHotKey":true,"pagerDirection":"first"}
            }).render('gitalk')
          })()
        </script>
    




    </body>
</html>
